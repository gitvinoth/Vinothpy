"(WITH baseline_values AS (SELECT epoch_timestamp, asset_id, pressure AS baseline_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'FM_001' AND epoch_timestamp = $baseline_timestamp) baseline_values, current_values AS (SELECT epoch_timestamp, asset_id, pressure AS current_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'FM_001' AND epoch_timestamp BETWEEN $start_time AND $end_time) current_values, differential AS (SELECT d.epoch_timestamp, abs((d.current_value - b.baseline_value) / b.baseline_value) * 100 AS value_difference FROM current_values d JOIN baseline_values b ON d.asset_id = b.asset_id ) differential SELECT DISTINCT epoch_timestamp as start_time FROM differential WHERE value_difference > 50.0) condition_1 inner join (WITH baseline_values AS (SELECT epoch_timestamp, asset_id, pressure AS baseline_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'FM_002' AND epoch_timestamp = $baseline_timestamp) baseline_values, current_values AS (SELECT epoch_timestamp, asset_id, pressure AS current_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'FM_002' AND epoch_timestamp BETWEEN $start_time AND $end_time) current_values, differential AS (SELECT d.epoch_timestamp, abs((d.current_value - b.baseline_value) / b.baseline_value) * 100 AS value_difference FROM current_values d JOIN baseline_values b ON d.asset_id = b.asset_id ) differential SELECT DISTINCT epoch_timestamp as start_time FROM differential WHERE value_difference > 50.0) condition_2 on condition_1.epoch_timestamp = condition_2.epoch_timestamp"
