rule_id	condition_id	combined_query	group_id	combined_query_updated_dte
1	1	SELECT start_time, '' AS end_time FROM (select condition_1.timestamp as start_time from (select `timestamp` from `$catalog`.silver_zone.dss where asset_id='TW_001'and wire = 'wire 1' and depth between 0 and 2000 and cast(`timestamp` as bigint) between $start_time and $end_time group by `timestamp` having avg(bend_mag) > 0.3 ) as condition_1) INTERSECT select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from (select condition_1.epoch_timestamp from (select epoch_timestamp, asset_id from `$catalog`.silver_zone.pt_gauge where pressure > 400.0 and asset_id = 'TW_001' and epoch_timestamp between $start_time - 1 and $end_time) condition_1) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 60 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time	3	2025-05-13T05:34:08.320+00:00
1	2	SELECT start_time, '' AS end_time FROM (select condition_1.timestamp as start_time from (select `timestamp` from `$catalog`.silver_zone.dss where asset_id='TW_001'and wire = 'wire 1' and depth between 0 and 2000 and cast(`timestamp` as bigint) between $start_time and $end_time group by `timestamp` having avg(bend_mag) > 0.3 ) as condition_1) INTERSECT select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from (select condition_1.epoch_timestamp from (select epoch_timestamp, asset_id from `$catalog`.silver_zone.pt_gauge where pressure > 400.0 and asset_id = 'TW_001' and epoch_timestamp between $start_time - 1 and $end_time) condition_1) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 60 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time	3	2025-05-13T05:34:08.320+00:00
1	5502	SELECT start_time, '' AS end_time FROM (select condition_1.timestamp as start_time from (select `timestamp` from `$catalog`.silver_zone.dss where asset_id='TW_001'and wire = 'wire 1' and depth between 0 and 2000 and cast(`timestamp` as bigint) between $start_time and $end_time group by `timestamp` having avg(bend_mag) > 0.3 ) as condition_1) INTERSECT select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from (select condition_1.epoch_timestamp from (select epoch_timestamp, asset_id from `$catalog`.silver_zone.pt_gauge where pressure > 400.0 and asset_id = 'TW_001' and epoch_timestamp between $start_time - 1 and $end_time) condition_1) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 60 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time	3	2025-05-13T05:34:08.320+00:00
1	5503	SELECT start_time, '' AS end_time FROM (select condition_1.timestamp as start_time from (select `timestamp` from `$catalog`.silver_zone.dss where asset_id='TW_001'and wire = 'wire 1' and depth between 0 and 2000 and cast(`timestamp` as bigint) between $start_time and $end_time group by `timestamp` having avg(bend_mag) > 0.3 ) as condition_1) INTERSECT select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from (select condition_1.epoch_timestamp from (select epoch_timestamp, asset_id from `$catalog`.silver_zone.pt_gauge where pressure > 400.0 and asset_id = 'TW_001' and epoch_timestamp between $start_time - 1 and $end_time) condition_1) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 60 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time	3	2025-05-13T05:34:08.320+00:00
1	5503	SELECT start_time, end_time FROM (WITH baseline_tw_001 AS (SELECT depth, timestamp, bend_mag AS baseline_value FROM `$catalog`.silver_zone.dss WHERE asset_id = 'TW_001' AND wire = 1 AND depth BETWEEN 1000 AND 2000 AND timestamp = 1708992000 ), current_tw_001 AS (SELECT depth, timestamp, bend_mag AS current_value FROM `$catalog`.silver_zone.dss WHERE asset_id = 'TW_001' AND wire = 1 AND depth BETWEEN 1000 AND 2000 AND timestamp BETWEEN $start_time AND $end_time ), differential_tw_001 AS (SELECT d.timestamp, d.depth, ((d.current_value - b.baseline_value) / b.baseline_value) * 100 AS value_difference FROM current_tw_001 d JOIN baseline_tw_001 b ON d.depth = b.depth ), cte_tw_001 AS (select min(timestamp) as start_time, max(timestamp) as end_time from ( select timestamp, diff, grp, max(grp) over (order by timestamp rows between unbounded preceding and current row) group_member from (select timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select timestamp, coalesce((timestamp - lag(timestamp) OVER (ORDER BY timestamp)), 1) as diff from ( SELECT d.timestamp FROM differential_tw_001 d WHERE d.value_difference > 5.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(timestamp) - min(timestamp) >= 0 or min(timestamp) = $start_time - 1 or max(timestamp) = $end_time) SELECT t1.start_time, t1.end_time FROM cte_tw_001 t1) INTERSECT select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from (select condition_1.epoch_timestamp from (select epoch_timestamp, asset_id from `$catalog`.silver_zone.pt_gauge where pressure > 400.0 and asset_id = 'TW_001' and epoch_timestamp between $start_time - 1 and $end_time) condition_1) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 60 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time	2	2025-05-13T05:34:08.320+00:00
1	5503	SELECT start_time, '' AS end_time FROM (select condition_1.timestamp as start_time from (select DISTINCT(`timestamp`) as `timestamp` from `$catalog`.silver_zone.dss where asset_id='TW_001' and wire = 'wire 1' and depth between 0 and 2000 and bend_mag > 0.7 and cast(`timestamp` as bigint) between $start_time and $end_time) as condition_1) INTERSECT select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from (select condition_1.epoch_timestamp from (select epoch_timestamp, asset_id from `$catalog`.silver_zone.pt_gauge where pressure > 400.0 and asset_id = 'TW_001' and epoch_timestamp between $start_time - 1 and $end_time) condition_1) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 60 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time	1	2025-05-13T05:34:08.320+00:00
2	1	SELECT start_time, '' AS end_time FROM (select condition_1.timestamp as start_time from (select `timestamp` from `$catalog`.silver_zone.dss where asset_id='TW_001'and wire = 1 and depth between 1000 and 1500 and cast(`timestamp` as bigint) between $start_time and $end_time group by `timestamp` having avg(bend_mag) > 10.0 ) as condition_1) INTERSECT select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from (select condition_1.epoch_timestamp from (select epoch_timestamp, asset_id from `$catalog`.silver_zone.pt_gauge where pressure > 200.0 and asset_id = 'TW_001' and epoch_timestamp between $start_time - 1 and $end_time) condition_1) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 40 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time	1	2025-05-13T05:34:08.320+00:00
2	2	SELECT start_time, '' AS end_time FROM (select condition_1.timestamp as start_time from (select `timestamp` from `$catalog`.silver_zone.dss where asset_id='TW_001'and wire = 1 and depth between 1000 and 1500 and cast(`timestamp` as bigint) between $start_time and $end_time group by `timestamp` having avg(bend_mag) > 10.0 ) as condition_1) INTERSECT select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from (select condition_1.epoch_timestamp from (select epoch_timestamp, asset_id from `$catalog`.silver_zone.pt_gauge where pressure > 200.0 and asset_id = 'TW_001' and epoch_timestamp between $start_time - 1 and $end_time) condition_1) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 40 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time	1	2025-05-13T05:34:08.320+00:00
4	200	SELECT start_time, end_time FROM (WITH baseline_ptg_002 AS (SELECT epoch_timestamp, asset_id, pressure AS baseline_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_002' AND epoch_timestamp = 1708992000 ), current_ptg_002 AS (SELECT epoch_timestamp, asset_id, pressure AS current_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_002' AND epoch_timestamp BETWEEN $start_time AND $end_time ), differential_ptg_002 AS (SELECT d.epoch_timestamp,(d.current_value - b.baseline_value) AS value_difference FROM current_ptg_002 d JOIN baseline_ptg_002 b ON d.asset_id = b.asset_id ), cte_ptg_002 AS (select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from ( SELECT d.epoch_timestamp FROM differential_ptg_002 d WHERE d.value_difference > 200.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 40 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time) SELECT start_time, end_time FROM cte_ptg_002) INTERSECT SELECT start_time, end_time FROM (WITH base_flowmeter AS ( SELECT asset_id, timestamp, well_head_pressure FROM `$catalog`.silver_zone.flowmeter WHERE asset_id IN ('F202') AND timestamp BETWEEN $start_time AND $end_time ), cte_f202 AS (select min(timestamp) as start_time, max(timestamp) as end_time from ( select timestamp, diff, grp, max(grp) over (order by timestamp rows between unbounded preceding and current row) group_member from (select timestamp, diff, case when diff>3 then sum(diff) OVER (ORDER BY timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select timestamp, coalesce((timestamp - lag(timestamp) OVER (ORDER BY timestamp)), 1) as diff from ( SELECT timestamp FROM (SELECT timestamp FROM base_flowmeter WHERE asset_id = 'F202') a JOIN (SELECT timestamp, well_head_pressure FROM base_flowmeter WHERE asset_id = 'F202') b ON b.timestamp BETWEEN a.timestamp AND a.timestamp + (10 - 1) GROUP BY a.timestamp HAVING AVG(b.well_head_pressure) > 100.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(timestamp) - min(timestamp) >= 10 or min(timestamp) = $start_time - 3 or max(timestamp) = $end_time) SELECT start_time, end_time FROM ( SELECT start_time, end_time FROM cte_f202 ) all_anomalies) INTERSECT SELECT start_time, end_time FROM (WITH baseline_tw_001 AS (SELECT depth, timestamp, bend_mag AS baseline_value FROM `$catalog`.silver_zone.dss WHERE asset_id = 'TW_001' AND wire = 1 AND depth BETWEEN 1000 AND 1500 AND timestamp = 1708992000 ), current_tw_001 AS (SELECT depth, timestamp, bend_mag AS current_value FROM `$catalog`.silver_zone.dss WHERE asset_id = 'TW_001' AND wire = 1 AND depth BETWEEN 1000 AND 1500 AND timestamp BETWEEN $start_time AND $end_time ), differential_tw_001 AS (SELECT d.timestamp, d.depth, ((d.current_value - b.baseline_value) / b.baseline_value) * 100 AS value_difference FROM current_tw_001 d JOIN baseline_tw_001 b ON d.depth = b.depth ), cte_tw_001 AS (select min(timestamp) as start_time, max(timestamp) as end_time from ( select timestamp, diff, grp, max(grp) over (order by timestamp rows between unbounded preceding and current row) group_member from (select timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select timestamp, coalesce((timestamp - lag(timestamp) OVER (ORDER BY timestamp)), 1) as diff from ( SELECT d.timestamp FROM differential_tw_001 d WHERE d.value_difference > 10.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(timestamp) - min(timestamp) >= 0 or min(timestamp) = $start_time - 1 or max(timestamp) = $end_time) SELECT start_time, end_time FROM cte_tw_001) INTERSECT SELECT start_time, end_time FROM (WITH baseline_ptg_001 AS (SELECT epoch_timestamp, asset_id, pressure AS baseline_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_001' AND epoch_timestamp = 1708992000 ), current_ptg_001 AS (SELECT epoch_timestamp, asset_id, pressure AS current_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_001' AND epoch_timestamp BETWEEN $start_time AND $end_time ), differential_ptg_001 AS (SELECT d.epoch_timestamp,(d.current_value - b.baseline_value) AS value_difference FROM current_ptg_001 d JOIN baseline_ptg_001 b ON d.asset_id = b.asset_id ), cte_ptg_001 AS (select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from ( SELECT d.epoch_timestamp FROM differential_ptg_001 d WHERE d.value_difference > 200.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 40 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time) SELECT start_time, end_time FROM cte_ptg_001)	1	2025-05-13T05:34:08.320+00:00
4	200	SELECT start_time, end_time FROM (WITH baseline_ptg_002 AS (SELECT epoch_timestamp, asset_id, pressure AS baseline_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_002' AND epoch_timestamp = 1708992000 ), current_ptg_002 AS (SELECT epoch_timestamp, asset_id, pressure AS current_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_002' AND epoch_timestamp BETWEEN $start_time AND $end_time ), differential_ptg_002 AS (SELECT d.epoch_timestamp,(d.current_value - b.baseline_value) AS value_difference FROM current_ptg_002 d JOIN baseline_ptg_002 b ON d.asset_id = b.asset_id ), cte_ptg_002 AS (select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from ( SELECT d.epoch_timestamp FROM differential_ptg_002 d WHERE d.value_difference > 200.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 40 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time) SELECT start_time, end_time FROM cte_ptg_002) INTERSECT SELECT start_time, end_time FROM (WITH base_flowmeter AS ( SELECT asset_id, timestamp, well_head_pressure FROM `$catalog`.silver_zone.flowmeter WHERE asset_id IN ('F202') AND timestamp BETWEEN $start_time AND $end_time ), cte_f202 AS (select min(timestamp) as start_time, max(timestamp) as end_time from ( select timestamp, diff, grp, max(grp) over (order by timestamp rows between unbounded preceding and current row) group_member from (select timestamp, diff, case when diff>3 then sum(diff) OVER (ORDER BY timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select timestamp, coalesce((timestamp - lag(timestamp) OVER (ORDER BY timestamp)), 1) as diff from ( SELECT timestamp FROM (SELECT timestamp FROM base_flowmeter WHERE asset_id = 'F202') a JOIN (SELECT timestamp, well_head_pressure FROM base_flowmeter WHERE asset_id = 'F202') b ON b.timestamp BETWEEN a.timestamp AND a.timestamp + (10 - 1) GROUP BY a.timestamp HAVING AVG(b.well_head_pressure) > 100.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(timestamp) - min(timestamp) >= 10 or min(timestamp) = $start_time - 3 or max(timestamp) = $end_time) SELECT start_time, end_time FROM ( SELECT start_time, end_time FROM cte_f202 ) all_anomalies) INTERSECT SELECT start_time, end_time FROM (WITH baseline_tw_001 AS (SELECT depth, timestamp, bend_mag AS baseline_value FROM `$catalog`.silver_zone.dss WHERE asset_id = 'TW_001' AND wire = 1 AND depth BETWEEN 1000 AND 1500 AND timestamp = 1708992000 ), current_tw_001 AS (SELECT depth, timestamp, bend_mag AS current_value FROM `$catalog`.silver_zone.dss WHERE asset_id = 'TW_001' AND wire = 1 AND depth BETWEEN 1000 AND 1500 AND timestamp BETWEEN $start_time AND $end_time ), differential_tw_001 AS (SELECT d.timestamp, d.depth, ((d.current_value - b.baseline_value) / b.baseline_value) * 100 AS value_difference FROM current_tw_001 d JOIN baseline_tw_001 b ON d.depth = b.depth ), cte_tw_001 AS (select min(timestamp) as start_time, max(timestamp) as end_time from ( select timestamp, diff, grp, max(grp) over (order by timestamp rows between unbounded preceding and current row) group_member from (select timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select timestamp, coalesce((timestamp - lag(timestamp) OVER (ORDER BY timestamp)), 1) as diff from ( SELECT d.timestamp FROM differential_tw_001 d WHERE d.value_difference > 10.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(timestamp) - min(timestamp) >= 0 or min(timestamp) = $start_time - 1 or max(timestamp) = $end_time) SELECT start_time, end_time FROM cte_tw_001) INTERSECT SELECT start_time, end_time FROM (WITH baseline_ptg_001 AS (SELECT epoch_timestamp, asset_id, pressure AS baseline_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_001' AND epoch_timestamp = 1708992000 ), current_ptg_001 AS (SELECT epoch_timestamp, asset_id, pressure AS current_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_001' AND epoch_timestamp BETWEEN $start_time AND $end_time ), differential_ptg_001 AS (SELECT d.epoch_timestamp,(d.current_value - b.baseline_value) AS value_difference FROM current_ptg_001 d JOIN baseline_ptg_001 b ON d.asset_id = b.asset_id ), cte_ptg_001 AS (select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from ( SELECT d.epoch_timestamp FROM differential_ptg_001 d WHERE d.value_difference > 200.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 40 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time) SELECT start_time, end_time FROM cte_ptg_001)	1	2025-05-13T05:34:08.320+00:00
4	201	SELECT start_time, end_time FROM (WITH baseline_ptg_002 AS (SELECT epoch_timestamp, asset_id, pressure AS baseline_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_002' AND epoch_timestamp = 1708992000 ), current_ptg_002 AS (SELECT epoch_timestamp, asset_id, pressure AS current_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_002' AND epoch_timestamp BETWEEN $start_time AND $end_time ), differential_ptg_002 AS (SELECT d.epoch_timestamp,(d.current_value - b.baseline_value) AS value_difference FROM current_ptg_002 d JOIN baseline_ptg_002 b ON d.asset_id = b.asset_id ), cte_ptg_002 AS (select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from ( SELECT d.epoch_timestamp FROM differential_ptg_002 d WHERE d.value_difference > 200.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 40 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time) SELECT start_time, end_time FROM cte_ptg_002) INTERSECT SELECT start_time, end_time FROM (WITH base_flowmeter AS ( SELECT asset_id, timestamp, well_head_pressure FROM `$catalog`.silver_zone.flowmeter WHERE asset_id IN ('F202') AND timestamp BETWEEN $start_time AND $end_time ), cte_f202 AS (select min(timestamp) as start_time, max(timestamp) as end_time from ( select timestamp, diff, grp, max(grp) over (order by timestamp rows between unbounded preceding and current row) group_member from (select timestamp, diff, case when diff>3 then sum(diff) OVER (ORDER BY timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select timestamp, coalesce((timestamp - lag(timestamp) OVER (ORDER BY timestamp)), 1) as diff from ( SELECT timestamp FROM (SELECT timestamp FROM base_flowmeter WHERE asset_id = 'F202') a JOIN (SELECT timestamp, well_head_pressure FROM base_flowmeter WHERE asset_id = 'F202') b ON b.timestamp BETWEEN a.timestamp AND a.timestamp + (10 - 1) GROUP BY a.timestamp HAVING AVG(b.well_head_pressure) > 100.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(timestamp) - min(timestamp) >= 10 or min(timestamp) = $start_time - 3 or max(timestamp) = $end_time) SELECT start_time, end_time FROM ( SELECT start_time, end_time FROM cte_f202 ) all_anomalies) INTERSECT SELECT start_time, end_time FROM (WITH baseline_tw_001 AS (SELECT depth, timestamp, bend_mag AS baseline_value FROM `$catalog`.silver_zone.dss WHERE asset_id = 'TW_001' AND wire = 1 AND depth BETWEEN 1000 AND 1500 AND timestamp = 1708992000 ), current_tw_001 AS (SELECT depth, timestamp, bend_mag AS current_value FROM `$catalog`.silver_zone.dss WHERE asset_id = 'TW_001' AND wire = 1 AND depth BETWEEN 1000 AND 1500 AND timestamp BETWEEN $start_time AND $end_time ), differential_tw_001 AS (SELECT d.timestamp, d.depth, ((d.current_value - b.baseline_value) / b.baseline_value) * 100 AS value_difference FROM current_tw_001 d JOIN baseline_tw_001 b ON d.depth = b.depth ), cte_tw_001 AS (select min(timestamp) as start_time, max(timestamp) as end_time from ( select timestamp, diff, grp, max(grp) over (order by timestamp rows between unbounded preceding and current row) group_member from (select timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select timestamp, coalesce((timestamp - lag(timestamp) OVER (ORDER BY timestamp)), 1) as diff from ( SELECT d.timestamp FROM differential_tw_001 d WHERE d.value_difference > 10.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(timestamp) - min(timestamp) >= 0 or min(timestamp) = $start_time - 1 or max(timestamp) = $end_time) SELECT start_time, end_time FROM cte_tw_001) INTERSECT SELECT start_time, end_time FROM (WITH baseline_ptg_001 AS (SELECT epoch_timestamp, asset_id, pressure AS baseline_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_001' AND epoch_timestamp = 1708992000 ), current_ptg_001 AS (SELECT epoch_timestamp, asset_id, pressure AS current_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_001' AND epoch_timestamp BETWEEN $start_time AND $end_time ), differential_ptg_001 AS (SELECT d.epoch_timestamp,(d.current_value - b.baseline_value) AS value_difference FROM current_ptg_001 d JOIN baseline_ptg_001 b ON d.asset_id = b.asset_id ), cte_ptg_001 AS (select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from ( SELECT d.epoch_timestamp FROM differential_ptg_001 d WHERE d.value_difference > 200.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 40 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time) SELECT start_time, end_time FROM cte_ptg_001)	1	2025-05-13T05:34:08.320+00:00
4	202	SELECT start_time, end_time FROM (WITH baseline_ptg_002 AS (SELECT epoch_timestamp, asset_id, pressure AS baseline_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_002' AND epoch_timestamp = 1708992000 ), current_ptg_002 AS (SELECT epoch_timestamp, asset_id, pressure AS current_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_002' AND epoch_timestamp BETWEEN $start_time AND $end_time ), differential_ptg_002 AS (SELECT d.epoch_timestamp,(d.current_value - b.baseline_value) AS value_difference FROM current_ptg_002 d JOIN baseline_ptg_002 b ON d.asset_id = b.asset_id ), cte_ptg_002 AS (select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from ( SELECT d.epoch_timestamp FROM differential_ptg_002 d WHERE d.value_difference > 200.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 40 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time) SELECT start_time, end_time FROM cte_ptg_002) INTERSECT SELECT start_time, end_time FROM (WITH base_flowmeter AS ( SELECT asset_id, timestamp, well_head_pressure FROM `$catalog`.silver_zone.flowmeter WHERE asset_id IN ('F202') AND timestamp BETWEEN $start_time AND $end_time ), cte_f202 AS (select min(timestamp) as start_time, max(timestamp) as end_time from ( select timestamp, diff, grp, max(grp) over (order by timestamp rows between unbounded preceding and current row) group_member from (select timestamp, diff, case when diff>3 then sum(diff) OVER (ORDER BY timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select timestamp, coalesce((timestamp - lag(timestamp) OVER (ORDER BY timestamp)), 1) as diff from ( SELECT timestamp FROM (SELECT timestamp FROM base_flowmeter WHERE asset_id = 'F202') a JOIN (SELECT timestamp, well_head_pressure FROM base_flowmeter WHERE asset_id = 'F202') b ON b.timestamp BETWEEN a.timestamp AND a.timestamp + (10 - 1) GROUP BY a.timestamp HAVING AVG(b.well_head_pressure) > 100.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(timestamp) - min(timestamp) >= 10 or min(timestamp) = $start_time - 3 or max(timestamp) = $end_time) SELECT start_time, end_time FROM ( SELECT start_time, end_time FROM cte_f202 ) all_anomalies) INTERSECT SELECT start_time, end_time FROM (WITH baseline_tw_001 AS (SELECT depth, timestamp, bend_mag AS baseline_value FROM `$catalog`.silver_zone.dss WHERE asset_id = 'TW_001' AND wire = 1 AND depth BETWEEN 1000 AND 1500 AND timestamp = 1708992000 ), current_tw_001 AS (SELECT depth, timestamp, bend_mag AS current_value FROM `$catalog`.silver_zone.dss WHERE asset_id = 'TW_001' AND wire = 1 AND depth BETWEEN 1000 AND 1500 AND timestamp BETWEEN $start_time AND $end_time ), differential_tw_001 AS (SELECT d.timestamp, d.depth, ((d.current_value - b.baseline_value) / b.baseline_value) * 100 AS value_difference FROM current_tw_001 d JOIN baseline_tw_001 b ON d.depth = b.depth ), cte_tw_001 AS (select min(timestamp) as start_time, max(timestamp) as end_time from ( select timestamp, diff, grp, max(grp) over (order by timestamp rows between unbounded preceding and current row) group_member from (select timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select timestamp, coalesce((timestamp - lag(timestamp) OVER (ORDER BY timestamp)), 1) as diff from ( SELECT d.timestamp FROM differential_tw_001 d WHERE d.value_difference > 10.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(timestamp) - min(timestamp) >= 0 or min(timestamp) = $start_time - 1 or max(timestamp) = $end_time) SELECT start_time, end_time FROM cte_tw_001) INTERSECT SELECT start_time, end_time FROM (WITH baseline_ptg_001 AS (SELECT epoch_timestamp, asset_id, pressure AS baseline_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_001' AND epoch_timestamp = 1708992000 ), current_ptg_001 AS (SELECT epoch_timestamp, asset_id, pressure AS current_value FROM `$catalog`.silver_zone.pt_gauge WHERE asset_id = 'PTG_001' AND epoch_timestamp BETWEEN $start_time AND $end_time ), differential_ptg_001 AS (SELECT d.epoch_timestamp,(d.current_value - b.baseline_value) AS value_difference FROM current_ptg_001 d JOIN baseline_ptg_001 b ON d.asset_id = b.asset_id ), cte_ptg_001 AS (select min(epoch_timestamp) as start_time, max(epoch_timestamp) as end_time from ( select epoch_timestamp, diff, grp, max(grp) over (order by epoch_timestamp rows between unbounded preceding and current row) group_member from (select epoch_timestamp, diff, case when diff>1 then sum(diff) OVER (ORDER BY epoch_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) end grp from (select epoch_timestamp, coalesce((epoch_timestamp - lag(epoch_timestamp) OVER (ORDER BY epoch_timestamp)), 1) as diff from ( SELECT d.epoch_timestamp FROM differential_ptg_001 d WHERE d.value_difference > 200.0 ) condition_group) timestamp_diffs) anomaly_group_step_1) anomaly_group group by group_member having max(epoch_timestamp) - min(epoch_timestamp) >= 40 or min(epoch_timestamp) = $start_time - 1 or max(epoch_timestamp) = $end_time) SELECT start_time, end_time FROM cte_ptg_001)	1	2025-05-13T05:34:08.320+00:00
5835	5501	SELECT start_time, '' AS end_time FROM (select condition_1.timestamp as start_time from (select `timestamp` from `$catalog`.silver_zone.dss where asset_id='TW_001'and wire = 'wire 1' and depth between 0 and 2000 and cast(`timestamp` as bigint) between $start_time and $end_time group by `timestamp` having avg(bend_mag) > 0.3 ) as condition_1)	2	2025-05-13T05:34:08.320+00:00
5835	5502	SELECT start_time, '' AS end_time FROM (select condition_1.timestamp as start_time from (select `timestamp` from `$catalog`.silver_zone.dss where asset_id='TW_001'and wire = 'wire 1' and depth between 0 and 2000 and cast(`timestamp` as bigint) between $start_time and $end_time group by `timestamp` having avg(bend_mag) > 0.3 ) as condition_1)	2	2025-05-13T05:34:08.320+00:00
5835	5502	SELECT start_time, '' AS end_time FROM (select condition_1.timestamp as start_time from (select DISTINCT(`timestamp`) as `timestamp` from `$catalog`.silver_zone.dss where asset_id='TW_001' and wire = 'wire 1' and depth between 0 and 2000 and bend_mag > 0.7 and cast(`timestamp` as bigint) between $start_time and $end_time) as condition_1)	1	2025-05-13T05:34:08.320+00:00
